<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Ball of the Rings</title>

    <!-- CSS-->
    <link rel="stylesheet" type="text/css" href="style.css">

    <!-- Libraries-->
    <script src="libs/glm_utils.js" defer></script>
    <script src="libs/m4.js" defer></script>
    <script src="libs/jquery-3.6.0.js" defer></script>
    <script src="libs/mesh_utils.js" defer></script>
    <script src="libs/webgl-utils.js" defer></script>
    <script src="libs/dat.gui.js" defer></script>

    <script type="module" src="main.js" defer></script>

    <!-- Vertex Shader -->
    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec3 a_position; // Position vector
        attribute vec3 a_normal; // Normals vector
        attribute vec2 a_texcoord; // Texture coordinates vector

        uniform mat4 u_projection_matrix; // Prospective projection matrix
        uniform mat4 u_view_matrix; // View Matrix
        uniform vec3 u_viewWorldPosition; // Camera position

        // Translation vector
        uniform vec3 u_translation;
        uniform mat4 u_normalMatrix;

        // Fragment shader varyings
        varying vec3 v_normal;
        varying vec4 v_world_matrix;
        varying vec3 v_surfaceToView;
        varying vec2 v_texcoord;

        void main() {
            // Compute the position by multiplying the projection matrix with the view matrix and the vector
            // that's the vertex position + the translation of the object.

            // La posizione nello schermo (gl_Position) Ã¨ il prodotto fra posizione nel sistema dell'oggetto (world_position),
            // posizione della camera (u_view) e posizione della proiezione del canvas (u_projection)

            v_world_matrix = vec4(a_position + u_translation, 1.);
            gl_Position = u_projection_matrix * u_view_matrix * v_world_matrix;

            v_surfaceToView = u_viewWorldPosition - vec4(a_position, 1).xyz;
            v_normal = (u_normalMatrix * vec4(a_normal, 1)).xyz;
            v_texcoord = a_texcoord;
        }



    </script>

    <!-- Fragment Shader -->
    <script id="fragment-shader" type="x-shader/x-fragment">
        precision highp float;

        // Varying from the vertex shader
        varying vec3 v_normal;
        varying vec3 v_surfaceToView;
        varying vec2 v_texcoord;

        // Uniforms
        uniform vec3 diffuse;
        uniform vec3 ambient;
        uniform vec3 emissive;
        uniform vec3 specular;
        uniform float shininess;
        uniform float opacity;
        uniform vec3 u_lightDirection;
        uniform vec3 u_ambientLight;
        uniform vec3 u_colorLight;
        uniform sampler2D diffuseMap;

        void main () {
            vec3 normal = normalize(v_normal);
            vec3 surfaceToViewDirection = normalize(v_surfaceToView);
            vec3 halfVector = normalize(u_lightDirection + surfaceToViewDirection);

            // Lights setup
            float fakeLight = dot(u_lightDirection, normal) * .5 + .5;
            float specularLight = clamp(dot(normal, halfVector), 0.0, 1.0);

            // Diffusion calculation
            vec4 diffuseMapColor = texture2D(diffuseMap, v_texcoord);
            vec3 effectiveDiffuse = diffuse * diffuseMapColor.rgb * u_colorLight.rgb;
            float effectiveOpacity = opacity * diffuseMapColor.a;

            // Final fragment color computation
            gl_FragColor = vec4(
                emissive +
                ambient * u_ambientLight +
                effectiveDiffuse * fakeLight +
                specular * pow(specularLight, shininess),
                effectiveOpacity
            );
        }



    </script>

    <!--    <script  id="vertex-shader-3d" type="x-shader/x-vertex">-->
    <!--			attribute vec4 a_position;-->
    <!--			attribute vec2 a_texcoord;-->
    <!--			attribute vec3 a_normal;-->
    <!--			attribute vec4 a_color;-->


    <!--			uniform mat4 u_projection;-->
    <!--			uniform mat4 u_view;-->
    <!--			uniform mat4 u_world;-->
    <!--			uniform mat4 u_textureMatrix;-->

    <!--			varying vec2 v_texcoord;-->
    <!--			varying vec4 v_projectedTexcoord;-->
    <!--			varying vec3 v_normal;-->
    <!--			varying vec4 v_color;-->

    <!--			void main() {-->
    <!--				// Multiply the position by the matrix.-->
    <!--				vec4 worldPosition = u_world * a_position;-->

    <!--				gl_Position = u_projection * u_view * worldPosition;-->

    <!--				// Pass the texture coord to the fragment shader.-->
    <!--				v_texcoord = a_texcoord;-->

    <!--				v_projectedTexcoord = u_textureMatrix * worldPosition;-->

    <!--				// orient the normals and pass to the fragment shader-->
    <!--				v_normal = mat3(u_world) * a_normal;-->

    <!--				v_color = a_color;-->
    <!--			}-->
    <!--		</script>-->

    <!--    <script  id="fragment-shader-3d" type="x-shader/x-fragment">-->
    <!--			precision mediump float;-->

    <!--			// Passed in from the vertex shader.-->
    <!--			varying vec2 v_texcoord;-->
    <!--			varying vec4 v_projectedTexcoord;-->
    <!--			varying vec3 v_normal;-->
    <!--			varying vec4 v_color;-->

    <!--			uniform vec4 u_colorMult;-->
    <!--			uniform sampler2D u_texture;-->
    <!--			uniform sampler2D u_projectedTexture;-->
    <!--			uniform float u_bias;-->
    <!--			uniform vec3 u_reverseLightDirection;-->

    <!--			// Material Properties-->
    <!--			uniform sampler2D diffuseMap;-->
    <!--			uniform sampler2D normalMap;-->
    <!--			uniform vec3 diffuse;-->
    <!--			uniform vec3 ambient;-->
    <!--			uniform vec3 emissive;-->
    <!--			uniform vec3 specular;-->
    <!--			uniform float shininess;-->
    <!--			uniform float opacity;-->

    <!--			void main() {-->
    <!--				// because v_normal is a varying it's interpolated-->
    <!--				// so it will not be a unit vector. Normalizing it-->
    <!--				// will make it a unit vector again-->
    <!--				vec3 normal = normalize(v_normal);-->

    <!--				float light = dot(normal, u_reverseLightDirection);-->

    <!--				vec3 projectedTexcoord = v_projectedTexcoord.xyz / v_projectedTexcoord.w;-->
    <!--				float currentDepth = projectedTexcoord.z + u_bias;-->

    <!--				bool inRange =-->
    <!--				projectedTexcoord.x >= 0.0 &&-->
    <!--				projectedTexcoord.x <= 1.0 &&-->
    <!--				projectedTexcoord.y >= 0.0 &&-->
    <!--				projectedTexcoord.y <= 1.0;-->

    <!--				// the 'r' channel has the depth values-->
    <!--				float projectedDepth = texture2D(u_projectedTexture, projectedTexcoord.xy).r;-->
    <!--				float shadowLight = (inRange && projectedDepth <= currentDepth) ? 0.0 : 1.0;-->

    <!--				vec4 diffuseMapColor = texture2D(diffuseMap, v_texcoord);-->
    <!--    			vec3 effectiveDiffuse = diffuse * diffuseMapColor.rgb  * v_color.rgb;-->
    <!--    			float effectiveOpacity = opacity * diffuseMapColor.a * v_color.a;-->

    <!--    			//vec3 effectiveDiffuse = diffuse * diffuseMapColor.rgb;-->
    <!--    			//float effectiveOpacity = opacity * diffuseMapColor.a;-->

    <!--				vec4 texColor = texture2D(u_texture, v_texcoord) * u_colorMult;-->

    <!--				gl_FragColor = vec4(-->
    <!--					effectiveDiffuse.rgb * light * shadowLight,-->
    <!--					effectiveOpacity);-->
    <!--			}-->
    <!--		</script>-->

    <!--    <script  id="color-vertex-shader" type="x-shader/x-vertex">-->
    <!--			attribute vec4 a_position;-->

    <!--			uniform mat4 u_projection;-->
    <!--			uniform mat4 u_view;-->
    <!--			uniform mat4 u_world;-->

    <!--			void main() {-->
    <!--				// Multiply the position by the matrices.-->
    <!--				gl_Position = u_projection * u_view * u_world * a_position;-->
    <!--			}-->
    <!--		</script>-->
    <!--    <script  id="color-fragment-shader" type="x-shader/x-fragment">-->
    <!--			precision mediump float;-->

    <!--			uniform vec4 u_color;-->
    <!--			void main() {-->
    <!--				gl_FragColor = u_color;-->
    <!--			}-->
    <!--		</script>-->

</head>

<body>

<h1>The Ball of the Rings</h1>

<div class="row">
    <div class="column1">
        <canvas id="canvas" width="950" height="650"></canvas>
    </div>

    <div class="menu column2">
        <input id="startTimerButton" type="button" value="Start"/>
    </div>

    <!--    <hr id="line2" class="menu column2">-->

    <div class="menu column2 row-inside">

        <div class="col-inside">
            <p class="title">Score</p>
            <p id="counter"></p>
        </div>

        <!--        <div class="col-inside">-->
        <!--            <p class="title">Time</p>-->
        <!--            <p id="timer">00:00</p>-->
        <!--        </div>-->
    </div>

    <hr id="line1" class="menu column2">

    <div class="menu column2 show-on-desktop hide-on-mobile">
        <p class="title">Settings</p>

        <label for="toggleMyPhoto">Show my photo (restart required)</label>
        <input id="toggleMyPhoto" type="checkbox"/>

        <br>

        <label for="stopOnFloorReached">Stop game on floor reached</label>
        <input id="stopOnFloorReached" type="checkbox"/>

        <br>

        <label for="playMusic">Play sound effects</label>
        <input id="playMusic" type="checkbox" checked/>

        <br>

        <label>
            FPS:
            <select id="fpsID">
                <option value="12">12</option>
                <option value="24">24</option>
                <option value="30">30</option>
                <option value="60" selected>60</option>
                <option value="90">90</option>
                <option value="120">120</option>
            </select>
        </label>
        <div id="gui"></div>
    </div>

    <div class="show-on-mobile hide-on-desktop">
        <div id="status">
            Joystick
        </div>

        <div>
            <img style="position: relative; left: 100px;" width="800" src="img/red-round-clip-art-download-12.png"/>
            <div id="stick" style="position: relative; left: 250px; bottom: 600px;">
                <img width="400" src="img/joystick-blue.png"/>
            </div>
        </div>
    </div>

<!--    <audio id="bouncing" src="sound_effects/bouncing.mp3"></audio>-->
<!--    <audio id="soundtracks"></audio>-->
</div>

</body>


</html>